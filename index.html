<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UKSS Results System ‚Äî Secure Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg1:#021b13;
  --bg2:#053b29;
  --accent:#22c55e;
  --accent2:#16a34a;
  --danger:#ff6b6b;
  --text:#eafff4;
  --card:#03140f;
}
body{
  min-height:100vh;
  font-family:"Segoe UI",system-ui,Arial;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--text);
  overflow:hidden;
}

/* TRANSITION */
#transition{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#052e1f,#0b6b46);
  z-index:999;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:28px;
  font-weight:700;
  opacity:0;
  pointer-events:none;
  transition:.6s ease;
}
#transition.show{opacity:1}

/* WRAPPER */
.wrapper{
  width:900px;
  height:520px;
  display:grid;
  grid-template-columns:1fr 1fr;
  border-radius:28px;
  overflow:hidden;
  box-shadow:0 40px 100px rgba(0,0,0,.6);
  animation:pop .7s ease;
}
@keyframes pop{
  from{transform:scale(.95);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* LOGIN */
.login{
  background:var(--card);
  padding:46px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.login h2{font-size:28px}
.login p{font-size:14px;opacity:.7;margin-bottom:22px}

.field{margin-bottom:16px;position:relative}
.field label{font-size:13px}
.field input{
  width:100%;
  margin-top:6px;
  padding:14px 44px 14px 16px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:transparent;
  color:var(--text);
}
.field input:focus{
  outline:none;
  box-shadow:0 0 0 2px rgba(34,197,94,.5);
}

/* PASSWORD TOGGLE */
.toggle-pass{
  position:absolute;
  right:14px;
  top:42px;
  cursor:pointer;
  opacity:.6;
}
.toggle-pass:hover{opacity:1}

/* CAPS */
.caps{
  font-size:12px;
  color:#ffd166;
  display:none;
}

/* BUTTON */
.btn{
  margin-top:8px;
  padding:14px;
  border-radius:999px;
  border:none;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  font-weight:700;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}
.btn.loading{opacity:.7;pointer-events:none}
.spinner{
  width:18px;height:18px;
  border:3px solid rgba(0,0,0,.2);
  border-top-color:#000;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* STATUS */
.status{margin-top:14px;font-size:13px;min-height:18px}
.status.error{color:#ffb4b4}
.status.success{color:#9bffd0}

/* SHAKE */
.shake{animation:shake .35s}
@keyframes shake{
  0%,100%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  75%{transform:translateX(6px)}
}

/* WELCOME */
.welcome{
  background:linear-gradient(135deg,#0b6b46,#22c55e);
  padding:50px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.school-logo{
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:18px;
}
.school-logo img{width:56px}
.welcome h1{font-size:36px}

/* MOBILE */
@media(max-width:900px){
  .wrapper{grid-template-columns:1fr;width:95%;height:auto}
  .welcome{display:none}
}
</style>
</head>

<body>

<div id="transition">‚úî LOGIN SUCCESS</div>

<div class="wrapper" id="card">

  <!-- LOGIN -->
  <div class="login">
    <h2 id="roleGreeting">Login</h2>
    <p>Ingia kwenye mfumo wa matokeo</p>

    <form id="loginForm">
      <div class="field">
        <label>Email</label>
        <input id="email" type="email" required>
      </div>

      <div class="field">
        <label>Password</label>
        <input id="password" type="password" required>
        <span class="toggle-pass" id="togglePass">üëÅ</span>
        <div id="caps" class="caps">Caps Lock iko ON</div>
      </div>

      <button class="btn" id="loginBtn"><span>Login</span></button>
    </form>

    <div id="status" class="status"></div>
  </div>

  <!-- WELCOME -->
  <div class="welcome">
    <div class="school-logo">
      <img src="assets/school-logo.png" alt="School Logo">
      <h3>UMOJA KINGORI<br>SECONDARY SCHOOL</h3>
    </div>
    <h1>Welcome Back</h1>
    <p>Secure ¬∑ Fast ¬∑ Reliable Results Management</p>
  </div>

</div>

<!-- SOUNDS -->
<audio id="successSound" src="assets/sounds/success.mp3"></audio>
<audio id="errorSound" src="assets/sounds/error.mp3"></audio>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="./js/database.js"></script>

<script>
/* ENABLE AUDIO AFTER INTERACTION */
let audioEnabled=false;
document.body.addEventListener("click",()=>audioEnabled=true,{once:true});

/* ELEMENTS */
const emailInput=document.getElementById("email");
const passwordInput=document.getElementById("password");
const form=document.getElementById("loginForm");
const btn=document.getElementById("loginBtn");
const status=document.getElementById("status");
const card=document.getElementById("card");
const overlay=document.getElementById("transition");
const greeting=document.getElementById("roleGreeting");
const successSound=document.getElementById("successSound");
const errorSound=document.getElementById("errorSound");

/* CAPS LOCK */
const caps=document.getElementById("caps");
passwordInput.addEventListener("keyup",e=>{
  caps.style.display=e.getModifierState("CapsLock")?"block":"none";
});

/* TOGGLE PASSWORD */
document.getElementById("togglePass").onclick=()=>{
  passwordInput.type=passwordInput.type==="password"?"text":"password";
};

/* LOGIN */
form.addEventListener("submit",async e=>{
  e.preventDefault();
  btn.classList.add("loading");
  btn.innerHTML='<div class="spinner"></div>';
  status.textContent="";

  const email=emailInput.value.trim();
  const password=passwordInput.value;

  try{
    const cred=await firebase.auth()
      .signInWithEmailAndPassword(email,password);

    const doc=await firebase.firestore()
      .collection("staff").doc(cred.user.uid).get();

    if(!doc.exists) throw "NO_ROLE";

    const role=(doc.data().role||"").toLowerCase();

    const roleLabel={
      admin:"Admin",
      academic:"Academic Officer",
      headmaster:"Headmaster",
      teacher:"Teacher",
      classteacher:"Class Teacher"
    }[role]||"User";

    greeting.textContent="Karibu "+roleLabel;
    status.textContent="Umefanikiwa kuingia";
    status.className="status success";
    if(audioEnabled) successSound.play().catch(()=>{});
    overlay.classList.add("show");

    setTimeout(()=>{
      switch(role){
        case "admin": location.href="admin.html"; break;
        case "academic": location.href="academic.html"; break;
        case "headmaster": location.href="results.html"; break;
        case "teacher":
        case "classteacher": location.href="marks.html"; break;
        default:
          alert("Role haijatambulika. Wasiliana na Admin.");
          firebase.auth().signOut();
          location.href="index.html";
      }
    },900);

  }catch(err){
    status.textContent="Email au password sio sahihi";
    status.className="status error";
    if(audioEnabled) errorSound.play().catch(()=>{});
    card.classList.add("shake");
    setTimeout(()=>card.classList.remove("shake"),400);
    btn.innerHTML="<span>Login</span>";
    btn.classList.remove("loading");
  }
});
</script>

</body>
</html>
