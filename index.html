<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UKSS Results System â€” Staff Login</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}

body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:#041f17;
  overflow:hidden;
}

/* ===== SPLINE ===== */
.spline-bg{
  position:fixed;
  inset:0;
  z-index:1;
}
.spline-bg iframe{
  width:100%;
  height:100%;
  border:none;
}

/* ===== LOGIN CARD ===== */
.login-card{
  position:absolute;
  right:6%;
  top:50%;
  transform:translateY(-50%);
  width:420px;
  padding:30px;
  border-radius:22px;
  background:linear-gradient(180deg,#0b3f2b,#06261c);
  box-shadow:0 30px 80px rgba(0,0,0,.65);
  color:#eafff4;
  z-index:5;
  backdrop-filter:blur(10px);
  animation:cardIn .9s cubic-bezier(.2,.9,.2,1) forwards;
}

@keyframes cardIn{
  from{opacity:0;transform:translate(50px,-50%) scale(.96)}
  to{opacity:1;transform:translate(0,-50%) scale(1)}
}

.brand{
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:14px;
}
.brand-badge{
  width:56px;height:56px;
  border-radius:14px;
  background:linear-gradient(180deg,#22c55e,#16a34a);
  display:flex;align-items:center;justify-content:center;
  font-weight:900;color:#052013;font-size:20px;
}

label{display:block;margin-top:14px;font-size:13px}
input{
  width:100%;
  margin-top:6px;
  padding:13px 16px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:#03140f;
  color:#fff;
}
input:focus{
  outline:none;
  box-shadow:0 0 0 2px rgba(34,197,94,.45);
}

button{
  width:100%;
  margin-top:18px;
  padding:14px;
  border:none;
  border-radius:999px;
  background:linear-gradient(90deg,#22c55e,#16a34a);
  font-weight:700;
  font-size:16px;
  cursor:pointer;
}

.status{
  margin-top:12px;
  font-size:13px;
  min-height:18px;
}
.status.info{color:#c7ffe6}
.status.error{color:#ffb4b4}
.status.success{color:#8dffbf}

.roles{
  margin-top:14px;
  text-align:center;
  font-size:12px;
  opacity:.7;
}
</style>
</head>

<body>

<!-- ===== SPLINE ===== -->
<div class="spline-bg">
  <iframe
    id="splineFrame"
    src="https://prod.spline.design/yeuIYnuhhXQDO8UQ/scene.splinecode"
    allow="fullscreen"
  ></iframe>
</div>

<!-- ===== LOGIN ===== -->
<div class="login-card">
  <div class="brand">
    <div class="brand-badge">UK</div>
    <div>
      <h2>UKSS Results System</h2>
      <div style="font-size:13px;opacity:.8">
        UMOJA KINGORI SECONDARY â€” Staff Login
      </div>
    </div>
  </div>

  <form id="loginForm">
    <label>Email</label>
    <input id="email" type="email" required>

    <label>Password</label>
    <input id="password" type="password" required>

    <button type="submit">Login</button>
  </form>

  <div id="status" class="status info">Ingiza taarifa zako</div>
  <div class="roles">Admin â€¢ Academic â€¢ Headmaster â€¢ Teacher</div>
</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="./js/database.js"></script>

<script>
const frame  = document.getElementById("splineFrame");
const status = document.getElementById("status");

function spline(msg){
  frame.contentWindow.postMessage(msg, "*");
}

/* ===== INPUT INTERACTION ===== */
["email","password"].forEach(id=>{
  const el=document.getElementById(id);

  el.addEventListener("focus",()=>{
    spline("typing");
  });

  el.addEventListener("input",()=>{
    spline("typing");
  });

  el.addEventListener("blur",()=>{
    spline("idle");
  });
});

/* ===== LOGIN ===== */
document.getElementById("loginForm").addEventListener("submit", async e=>{
  e.preventDefault();
  spline("typing");

  const email=document.getElementById("email").value.trim();
  const pass=document.getElementById("password").value.trim();

  status.textContent="Inathibitisha...";
  status.className="status info";

  try{
    const cred=await firebase.auth()
      .signInWithEmailAndPassword(email,pass);

    const snap=await firebase.firestore()
      .collection("staff")
      .doc(cred.user.uid).get();

    if(!snap.exists) throw "NO_ROLE";

    spline("success");
    status.textContent="Karibu ðŸŽ‰";
    status.className="status success";

    setTimeout(()=>{
      const r=snap.data().role;
      if(r==="admin")location.href="admin.html";
      else if(r==="academic")location.href="marks.html";
      else if(r==="headmaster")location.href="results.html";
      else location.href="marks.html";
    },1200);

  }catch(err){
    spline("error");
    status.textContent="Email au password sio sahihi";
    status.className="status error";
  }
});
</script>

</body>
</html>
