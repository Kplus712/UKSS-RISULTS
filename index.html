<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UKSS Results System â€” Login</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}

body{
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:radial-gradient(circle at 30% 30%,#0b5f45,#041f17 60%);
  overflow:hidden;
  color:#eafff4;
}

/* ===== SPLINE BACKGROUND ===== */
.spline{
  position:fixed;
  inset:0;
  z-index:1;
}
.spline iframe{
  width:100%;
  height:100%;
  border:none;
}

/* MOBILE FALLBACK */
@media(max-width:900px){
  .spline{display:none;}
}

/* ===== LOGIN CARD ===== */
.login{
  position:absolute;
  right:6%;
  top:50%;
  transform:translateY(-50%);
  width:420px;
  padding:30px;
  border-radius:26px;
  background:linear-gradient(180deg,#0b3f2b,#06261c);
  box-shadow:
    0 40px 90px rgba(0,0,0,.65),
    inset 0 0 0 1px rgba(255,255,255,.04);
  z-index:5;
  animation:cardFloat 6s ease-in-out infinite;
}

@keyframes cardFloat{
  0%,100%{transform:translateY(-50%)}
  50%{transform:translateY(calc(-50% - 6px))}
}

.brand{
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:14px;
}
.logo{
  width:56px;height:56px;
  border-radius:16px;
  background:linear-gradient(180deg,#22c55e,#16a34a);
  display:flex;align-items:center;justify-content:center;
  font-weight:900;color:#052013;font-size:20px;
  box-shadow:0 0 30px rgba(34,197,94,.6);
}

label{
  display:block;
  margin-top:14px;
  font-size:13px;
  opacity:.9;
}
input{
  width:100%;
  margin-top:6px;
  padding:13px 16px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:#03140f;
  color:#fff;
  transition:.25s;
}
input:focus{
  outline:none;
  box-shadow:
    0 0 0 2px rgba(34,197,94,.45),
    0 0 30px rgba(34,197,94,.35);
}

button{
  width:100%;
  margin-top:18px;
  padding:14px;
  border:none;
  border-radius:999px;
  background:linear-gradient(90deg,#22c55e,#16a34a);
  font-weight:700;
  font-size:16px;
  cursor:pointer;
  box-shadow:0 20px 40px rgba(34,197,94,.45);
  transition:.2s;
}
button:hover{transform:translateY(-1px)}
button:active{transform:translateY(0)}

.status{
  margin-top:12px;
  font-size:13px;
  min-height:18px;
}
.info{color:#c7ffe6}
.error{color:#ffb4b4}
.success{color:#8dffbf}

.roles{
  margin-top:14px;
  text-align:center;
  font-size:12px;
  opacity:.7;
}
</style>
</head>

<body>

<!-- ===== SPLINE ===== -->
<div class="spline">
  <iframe id="splineFrame"
    src="https://prod.spline.design/yeuIYnuhhXQDO8UQ/scene.splinecode">
  </iframe>
</div>

<!-- ===== LOGIN ===== -->
<div class="login">
  <div class="brand">
    <div class="logo">UK</div>
    <div>
      <h2>UKSS Results System</h2>
      <div style="font-size:13px;opacity:.8">
        UMOJA KINGORI SECONDARY â€” Staff Login
      </div>
    </div>
  </div>

  <form id="loginForm">
    <label>Email</label>
    <input id="email" type="email" required>

    <label>Password</label>
    <input id="password" type="password" required>

    <button>Login</button>
  </form>

  <div id="status" class="status info">Ingiza taarifa zako</div>
  <div class="roles">Admin â€¢ Academic â€¢ Headmaster â€¢ Teacher</div>
</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="./js/database.js"></script>

<script>
/* ===== SPLINE COMM ===== */
const frame=document.getElementById("splineFrame");
function spline(msg){
  if(frame && frame.contentWindow){
    frame.contentWindow.postMessage(msg,"*");
  }
}

/* ===== SAFE SOUND (USER INTERACTION) ===== */
let audioReady=false;
const clickSound=new Audio("./assets/sounds/click.mp3");
document.addEventListener("click",()=>{
  if(!audioReady){
    clickSound.play().catch(()=>{});
    audioReady=true;
  }
},{once:true});

/* ===== INPUT REACTION ===== */
const email=document.getElementById("email");
const pass=document.getElementById("password");

[email,pass].forEach(el=>{
  el.addEventListener("focus",()=>{
    spline(el.id==="email"?"lookEmail":"lookPassword");
  });
  el.addEventListener("input",()=>spline("typing"));
  el.addEventListener("blur",()=>spline("idle"));
});

/* ===== LOGIN ===== */
const status=document.getElementById("status");

document.getElementById("loginForm").addEventListener("submit",async e=>{
  e.preventDefault();
  spline("typing");

  status.textContent="Inathibitisha...";
  status.className="status info";

  try{
    const cred=await firebase.auth()
      .signInWithEmailAndPassword(email.value,pass.value);

    const snap=await firebase.firestore()
      .collection("staff")
      .doc(cred.user.uid).get();

    if(!snap.exists) throw "NO_ROLE";

    spline("success");
    status.textContent="Karibu ðŸŽ‰";
    status.className="status success";

    setTimeout(()=>{
      const r=snap.data().role;
      location.href=
        r==="admin"?"admin.html":
        r==="headmaster"?"results.html":
        r==="academic"?"academic.html":
        "marks.html";
    },1300);

  }catch(err){
    spline("error");
    status.textContent=
      err==="NO_ROLE"
      ?"Account haina role"
      :"Email au password sio sahihi";
    status.className="status error";
  }
});
</script>

</body>
</html>

