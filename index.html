<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>UKSS Results System â€” Secure Login</title>

<style>
:root{
  --green:#22c55e;
  --green2:#16a34a;
  --dark:#041b12;
  --card:#0b3f2b;
}

/* RESET */
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:
    radial-gradient(1200px 600px at 10% 10%,#0d5a3d,#03140d),
    radial-gradient(800px 400px at 90% 90%,#083d2a,#020b07);
  font-family:system-ui,Segoe UI,Roboto;
  color:#eafff3;
  overflow:hidden;
}

/* ===== SCENE ===== */
.scene{
  display:flex;
  gap:90px;
  align-items:center;
  perspective:1400px;
}

/* ===== CHARACTER (SOFT 3D ABSTRACT AVATAR) ===== */
.avatar{
  width:180px;
  height:300px;
  border-radius:90px 90px 40px 40px;
  background:linear-gradient(180deg,#34d399,#059669);
  box-shadow:
    0 40px 80px rgba(0,0,0,.6),
    inset 0 6px 20px rgba(255,255,255,.25);
  transform:
    translateX(-400px)
    translateZ(120px);
  animation: walkIn 1.8s cubic-bezier(.2,.8,.2,1) forwards,
             idleFloat 4s ease-in-out infinite 2s;
}

/* walk in */
@keyframes walkIn{
  to{transform:translateX(0) translateZ(120px)}
}

/* idle breathing */
@keyframes idleFloat{
  0%,100%{transform:translateZ(120px) translateY(0)}
  50%{transform:translateZ(130px) translateY(-8px)}
}

/* ===== LOGIN CARD ===== */
.card{
  width:400px;
  padding:30px;
  border-radius:24px;
  background:linear-gradient(180deg,#0b3f2b,#06271c);
  box-shadow:
    0 50px 100px rgba(0,0,0,.75),
    inset 0 1px 0 rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.05);
  opacity:0;
  transform:
    translateX(80px)
    scale(.9)
    translateZ(60px);
  animation: cardIn .9s cubic-bezier(.2,.8,.2,1) forwards;
  animation-delay:1.6s;
}

/* card entrance */
@keyframes cardIn{
  to{
    opacity:1;
    transform:translateX(0) scale(1) translateZ(80px);
  }
}

h1{margin:0;font-size:22px}
.sub{opacity:.8;font-size:13px;margin-bottom:18px}

label{font-size:13px}
input{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:#03140e;
  color:#eafff3;
  font-size:14px;
}
input:focus{
  outline:none;
  border-color:var(--green);
  box-shadow:0 0 0 3px rgba(34,197,94,.15);
}

button{
  width:100%;
  margin-top:18px;
  padding:14px;
  border-radius:30px;
  border:0;
  background:linear-gradient(90deg,var(--green),var(--green2));
  font-weight:700;
  font-size:16px;
  cursor:pointer;
  transition:.2s;
}
button:hover{transform:translateY(-2px)}
button:active{transform:translateY(0)}

.msg{
  margin-top:12px;
  font-size:13px;
  min-height:18px;
}
.msg.error{color:#ffb4b4}
.msg.success{color:#a7f3d0}

.footer{
  margin-top:14px;
  font-size:12px;
  opacity:.7;
  text-align:center;
}
</style>
</head>

<body>

<div class="scene">
  <div class="avatar"></div>

  <form class="card" id="loginForm">
    <h1>UKSS Results System</h1>
    <div class="sub">UMOJA KINGORI SECONDARY â€” Staff Login</div>

    <label>Email</label>
    <input id="email" type="email" required>

    <label style="margin-top:12px">Password</label>
    <input id="password" type="password" required>

    <button type="submit">Login</button>

    <div id="msg" class="msg"></div>

    <div class="footer">
      Admin â€¢ Academic â€¢ Headmaster â€¢ Teacher
    </div>
  </form>
</div>

<!-- FIREBASE v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
/* ==== FIREBASE INIT ==== */
firebase.initializeApp({
  apiKey:"YOUR_KEY",
  authDomain:"YOUR_PROJECT.firebaseapp.com",
  projectId:"YOUR_PROJECT"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* ==== LOGIN + AUDIT LOGS ==== */
const form=document.getElementById("loginForm");
const msg=document.getElementById("msg");

form.addEventListener("submit",async e=>{
  e.preventDefault();
  msg.textContent="Inathibitisha...";
  msg.className="msg";

  const email=emailEl.value=emailEl=document.getElementById("email").value;
  const pass=document.getElementById("password").value;

  let success=false, role="unknown";

  try{
    const cred=await auth.signInWithEmailAndPassword(email,pass);
    const snap=await db.collection("staff").doc(cred.user.uid).get();
    if(!snap.exists) throw "NO_ROLE";

    role=snap.data().role;
    success=true;

    msg.textContent="Karibu ðŸŽ‰";
    msg.className="msg success";

    setTimeout(()=>{
      if(role==="admin") location.href="admin.html";
      else if(role==="academic") location.href="marks.html";
      else if(role==="headmaster") location.href="results.html";
      else location.href="marks.html";
    },900);

  }catch(err){
    msg.className="msg error";
    msg.textContent=
      err==="NO_ROLE"
      ? "Account haina role. Wasiliana na Admin."
      : "Email au password sio sahihi.";
  }

  /* AUDIT LOG */
  db.collection("login_logs").add({
    email,
    role,
    success,
    time:firebase.firestore.FieldValue.serverTimestamp()
  });
});
</script>

</body>
</html>
