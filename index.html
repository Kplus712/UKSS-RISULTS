<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UKSS Results System â€” Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg1:#021b13;
  --bg2:#053b29;
  --accent:#22c55e;
  --accent2:#16a34a;
  --text:#eafff4;
  --card:#03140f;
}
body.light{
  --bg1:#eafff4;
  --bg2:#c7f9df;
  --card:#ffffff;
  --text:#052a1e;
}

body{
  min-height:100vh;
  font-family:"Segoe UI",system-ui,Arial;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--text);
  transition:.4s;
}

/* WRAPPER */
.wrapper{
  width:900px;
  height:520px;
  display:grid;
  grid-template-columns:1fr 1fr;
  border-radius:28px;
  overflow:hidden;
  box-shadow:0 40px 100px rgba(0,0,0,.6);
  animation:pop .8s ease;
}
@keyframes pop{
  from{transform:scale(.92);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* LOGIN */
.login{
  background:var(--card);
  padding:46px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.login h2{font-size:28px}
.login p{font-size:14px;opacity:.7;margin-bottom:22px}

.field{margin-bottom:16px}
.field label{font-size:13px}
.field input{
  width:100%;
  margin-top:6px;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:transparent;
  color:var(--text);
}
.field input:focus{
  outline:none;
  box-shadow:0 0 0 2px rgba(34,197,94,.5);
}

.btn{
  padding:14px;
  border-radius:999px;
  border:none;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  font-weight:700;
  cursor:pointer;
  transition:.3s;
}
.btn.loading{
  opacity:.7;
  pointer-events:none;
}
.btn:hover{transform:translateY(-2px)}

.status{
  margin-top:14px;
  font-size:13px;
  min-height:18px;
}
.status.error{color:#ffb4b4}
.status.success{color:#9bffd0}

.roles{
  margin-top:20px;
  font-size:12px;
  opacity:.6;
  text-align:center;
}

/* WELCOME */
.welcome{
  background:linear-gradient(135deg,#0b6b46,#22c55e);
  padding:50px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  position:relative;
  animation:slideIn 1s ease;
}
@keyframes slideIn{
  from{transform:translateX(40px);opacity:0}
  to{transform:none;opacity:1}
}

.school-logo{
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:18px;
}
.school-logo img{
  width:52px;
  height:52px;
}
.school-logo h3{
  font-size:18px;
  line-height:1.2;
}

.welcome h1{
  font-size:36px;
  margin-bottom:10px;
}
.welcome p{
  max-width:320px;
  line-height:1.6;
}
.cursor{
  display:inline-block;
  width:2px;
  height:1em;
  background:#fff;
  animation:blink 1s infinite;
}
@keyframes blink{50%{opacity:0}}

.theme-btn{
  position:absolute;
  top:20px;
  right:20px;
  border:none;
  background:rgba(255,255,255,.2);
  color:#fff;
  padding:6px 12px;
  border-radius:999px;
  cursor:pointer;
}

/* MOBILE */
@media(max-width:900px){
  .wrapper{grid-template-columns:1fr;width:95%;height:auto}
  .welcome{display:none}
}
</style>
</head>

<body>

<div class="wrapper">

  <!-- LOGIN PANEL -->
  <div class="login">
    <h2>Login</h2>
    <p id="typingStatus"></p>

    <form id="loginForm">
      <div class="field">
        <label>Email</label>
        <input id="email" type="email" required>
      </div>
      <div class="field">
        <label>Password</label>
        <input id="password" type="password" required>
      </div>
      <button class="btn" id="loginBtn">Login</button>
    </form>

    <div id="status" class="status"></div>

    <div class="roles">
      Admin â€¢ Academic â€¢ Headmaster â€¢ Teacher
    </div>
  </div>

  <!-- WELCOME -->
  <div class="welcome">
    <button class="theme-btn" id="themeBtn">Theme</button>

    <!-- LOGO ADDED HERE -->
    <div class="school-logo">
      <img src="assets/logo.png" alt="School Logo">
      <h3>UMOJA KINGORI<br>SECONDARY SCHOOL</h3>
    </div>

    <h1 id="welcomeText"></h1>
    <p>
      We are happy to have you again.  
      Manage results securely and professionally.
    </p>
  </div>

</div>

<!-- SOUNDS (will play only after interaction) -->
<audio id="typingSound" src="assets/sounds/typing.mp3"></audio>
<audio id="successSound" src="assets/sounds/success.mp3"></audio>
<audio id="errorSound" src="assets/sounds/error.mp3"></audio>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="./js/database.js"></script>

<script>
/* THEME */
document.getElementById("themeBtn").onclick=()=>{
  document.body.classList.toggle("light");
};

/* TYPING EFFECT */
let audioEnabled=false;
document.body.addEventListener("click",()=>audioEnabled=true,{once:true});

function type(el,text,delay=60){
  let i=0;
  el.textContent="";
  const snd=document.getElementById("typingSound");
  const t=setInterval(()=>{
    el.textContent+=text[i++];
    if(audioEnabled){ snd.currentTime=0; snd.play().catch(()=>{}); }
    if(i>=text.length) clearInterval(t);
  },delay);
}
type(document.getElementById("welcomeText"),"WELCOME BACK!");
type(document.getElementById("typingStatus"),"Ingia kwenye mfumo wa matokeo...");

/* LOGIN */
const form=document.getElementById("loginForm");
const status=document.getElementById("status");
const btn=document.getElementById("loginBtn");

form.addEventListener("submit",async e=>{
  e.preventDefault();
  btn.classList.add("loading");
  btn.textContent="Inathibitisha...";
  status.textContent="";

  try{
    const email=document.getElementById("email").value.trim();
    const password=document.getElementById("password").value;

    const cred=await firebase.auth()
      .signInWithEmailAndPassword(email,password);

    const snap=await firebase.firestore()
      .collection("staff").doc(cred.user.uid).get();

    if(!snap.exists) throw "NO_ROLE";

    status.textContent="Karibu ðŸŽ‰";
    status.className="status success";
    if(audioEnabled) document.getElementById("successSound").play().catch(()=>{});

    setTimeout(()=>{
      const r=snap.data().role;
      location.href=
        r==="admin"?"admin.html":
        r==="academic"?"academic.html":
        r==="headmaster"?"results.html":
        "marks.html";
    },800);

  }catch(err){
    status.textContent="Email au password sio sahihi";
    status.className="status error";
    if(audioEnabled) document.getElementById("errorSound").play().catch(()=>{});
    btn.textContent="Login";
    btn.classList.remove("loading");
  }
});
</script>

</body>
</html>

