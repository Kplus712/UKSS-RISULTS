<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UKSS Results System â€” Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- SPLINE -->
<script type="module" src="https://unpkg.com/@splinetool/viewer@1.9.9/build/spline-viewer.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --green:#22c55e;
  --dark:#021b13;
  --card:#03140f;
  --text:#eafff4;
}
body{
  height:100vh;
  background:linear-gradient(135deg,#021b13,#053b29);
  font-family:"Segoe UI",system-ui,Arial;
  color:var(--text);
  display:flex;
  justify-content:center;
  align-items:center;
}

.wrapper{
  width:1100px;
  height:560px;
  display:grid;
  grid-template-columns:1.2fr 1fr;
  border-radius:30px;
  overflow:hidden;
  box-shadow:0 50px 120px rgba(0,0,0,.7);
}

/* LEFT â€“ SPLINE */
.scene{
  position:relative;
  background:#020c08;
}
spline-viewer{
  width:100%;
  height:100%;
}

/* RIGHT â€“ LOGIN */
.login{
  background:var(--card);
  padding:44px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.logo{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:16px;
}
.logo img{
  width:46px;
  height:46px;
}
.logo h2{font-size:22px}

.login p{
  opacity:.7;
  margin-bottom:22px;
}

.field{margin-bottom:16px}
.field label{font-size:13px}
.field input{
  width:100%;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:transparent;
  color:var(--text);
}
.field input:focus{
  outline:none;
  box-shadow:0 0 0 2px rgba(34,197,94,.6);
}

.btn{
  margin-top:6px;
  padding:14px;
  border-radius:999px;
  border:none;
  background:linear-gradient(90deg,#22c55e,#16a34a);
  font-weight:700;
  cursor:pointer;
}
.btn:hover{transform:translateY(-2px)}

.status{
  margin-top:14px;
  font-size:13px;
  min-height:18px;
}
.status.error{color:#ffb4b4}
.status.success{color:#9bffd0}

/* LOADING */
.loader{
  width:22px;height:22px;
  border:3px solid rgba(255,255,255,.3);
  border-top-color:#22c55e;
  border-radius:50%;
  animation:spin 1s linear infinite;
  display:inline-block;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* MOBILE */
@media(max-width:950px){
  .wrapper{grid-template-columns:1fr;width:96%}
  .scene{display:none}
}
</style>
</head>

<body>

<div class="wrapper">

  <!-- SPLINE SCENE -->
  <div class="scene">
    <spline-viewer
      id="spline"
      scene="https://prod.spline.design/yeuIYnuhhXQDO8UQ/scene.splinecode">
    </spline-viewer>
  </div>

  <!-- LOGIN -->
  <div class="login">
    <div class="logo">
      <img src="assets/logo.png" alt="School Logo">
      <h2>UKSS Results System</h2>
    </div>

    <p>Staff Login â€” Admin â€¢ Academic â€¢ Headmaster â€¢ Teacher</p>

    <form id="loginForm">
      <div class="field">
        <label>Email</label>
        <input id="email" type="email" required>
      </div>
      <div class="field">
        <label>Password</label>
        <input id="password" type="password" required>
      </div>
      <button class="btn" id="loginBtn">Login</button>
    </form>

    <div id="status" class="status"></div>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="./js/database.js"></script>

<script>
const status=document.getElementById("status");
const btn=document.getElementById("loginBtn");

/* SPLINE CONTROL */
const spline=document.getElementById("spline");
function splineEvent(name){
  try{
    spline.dispatchEvent(new CustomEvent(name));
  }catch(e){}
}

/* INPUT TYPING â†’ CHARACTER REACT */
document.querySelectorAll("input").forEach(i=>{
  i.addEventListener("input",()=> splineEvent("typing"));
});

/* LOGIN */
document.getElementById("loginForm").addEventListener("submit",async e=>{
  e.preventDefault();
  btn.innerHTML='<span class="loader"></span>';
  status.textContent="Inathibitisha taarifa...";
  splineEvent("loading");

  try{
    const email=document.getElementById("email").value.trim();
    const pass=document.getElementById("password").value;

    const cred=await firebase.auth()
      .signInWithEmailAndPassword(email,pass);

    const snap=await firebase.firestore()
      .collection("staff").doc(cred.user.uid).get();

    if(!snap.exists) throw "NO_ROLE";

    status.textContent="Karibu ðŸŽ‰";
    status.className="status success";
    splineEvent("success");

    setTimeout(()=>{
      const r=snap.data().role;
      location.href=
        r==="admin"?"admin.html":
        r==="academic"?"academic.html":
        r==="headmaster"?"results.html":
        "marks.html";
    },1000);

  }catch(err){
    btn.textContent="Login";
    status.textContent="Email au password sio sahihi";
    status.className="status error";
    splineEvent("error");
  }
});
</script>

</body>
</html>

